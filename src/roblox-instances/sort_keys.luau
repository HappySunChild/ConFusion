local instances = require("./types")

local External = require("../core-external/External")

local STAGE_ORDER = table.freeze({
	self = 1,
	descendants = 2,
	properties = 4,
	ancestor = 8,
	observer = 16,
	last = math.huge,
})

local function sort_keys(a: instances.SpecialKey, b: instances.SpecialKey)
	local a_order = STAGE_ORDER[a.stage]
	local b_order = STAGE_ORDER[b.stage]

	if a_order == nil then
		External.log_warn(
			if a.stage == nil
				then instances.missing_specialkey_stage
				else instances.invalid_specialkey_stage,
			a.type,
			a.stage
		)

		return true
	elseif b_order == nil then
		External.log_warn(
			if b.stage == nil
				then instances.missing_specialkey_stage
				else instances.invalid_specialkey_stage,
			b.type,
			b.stage
		)

		return false
	end

	return a_order < b_order
end

return sort_keys
